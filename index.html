<!DOCTYPE HTML>
<html>
<head>
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet">
</head>
<style>

    .hidden {
        display: none;
    }

    /* prevents selection when left click dragging */
    .disable-selection {
        -moz-user-select: none; -webkit-user-select: none; -ms-user-select:none; user-select:none;
    }

    /* prevents cursor from changing to the i bar on the overlays*/
    .noIbar {
        cursor:default;
    }

    /* images are displayed in viewports */
    .viewport {
        width:512px;
        height:512px;
        top:0px;
        left:0px;
        position:absolute
    }
</style>
<body>
<div id="wrap">
    <div class="container">

        <div class="page-header">
            <h1>
                Cornerstone Demo
            </h1>
        </div>

        <ul id="tabs" class="nav nav-tabs">
            <li class="active"><a href="#studyList" data-toggle="tab">Study List</a></li>
        </ul>

        <div id="tabContent" class="tab-content">
            <div id="studyList" class="tab-pane active">
                <div class="row">
                    <table class="col-md-12 table table-striped">
                        <thead>
                        <tr>
                            <th>Patient Name</th>
                            <th>Patient ID</th>
                            <th>Study Date</th>
                            <th>Modality</th>
                            <th>Study Description</th>
                            <th># Images</th>
                        </tr>
                        </thead>
                        <tbody id="studyListData">

                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="studyViewerTemplate" class="tab-pane active hidden">
            <div class="row">
                <div style="width:512px;height:512px;position:relative;color: white;display:inline-block;background-color:black;"
                     oncontextmenu="return false"
                     class='disable-selection noIbar'
                     unselectable='on'
                     onselectstart='return false;'
                     onmousedown='return false;'>
                    <div id="dicomImage" class="viewport">
                    </div>
                    <div id="mrtopleft" style="position: absolute;top:0px; left:0px">
                        Patient Name
                    </div>
                    <div id="mrtopright" style="position: absolute;top:0px; right:0px">
                        Hospital
                    </div>
                    <div id="mrbottomright" style="position: absolute;bottom:0px; right:0px">
                        Zoom:
                    </div>
                    <div id="mrbottomleft" style="position: absolute;bottom:0px; left:0px">
                        WW/WC:
                    </div>

                </div>
            </div>
        </div>
    </div>

<div id="footer">
    <div class="navbar navbar-inner navbar-fixed-bottom container">
        <strong>This demo requires a HTLM5 browser, Google Chrome is recommended</strong>
        <br>
        Read about the <a href="architecture.html">architecture</a> for this demo
    </div>
</div>

</div>

<script src="https://code.jquery.com/jquery-2.1.0.min.js"></script>

<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js" ></script>

<!-- include the cornerstone library -->
<script src="cornerstone.js"></script>

<!-- include the cornerstone tools library -->
<script src="cornerstone-tools.js"></script>

<!-- include the cornerstoneWADOImageLoader library -->
<script src="cornerstoneWADOImageLoader.js"></script>

<!-- include the cornerstoneWADOImageLoader library -->
<script src="dicomParser.js"></script>

    <script>

    $('#tabs a').click(function (e) {
        e.preventDefault()
        $(this).tab('show')
    })

    function loadStudyJson(studyId)
    {
        $.getJSON(studyId, function(data) {
            // Load the first series into the viewport
            var url = data.seriesList[0].instanceList[0].imageId;
            $('#wadoURL').val();

            // image enable the dicomImage element and activate a few tools
            var element = $('#dicomImage').get(0);
            cornerstone.enable(element, url);
            cornerstoneTools.wwwc.activate(element, 1); //
            cornerstoneTools.pan.activate(element, 2); //
            cornerstoneTools.zoom.activate(element, 3); //
        });
    }


    $.getJSON('studyList.json', function(data)
    {
        data.studyList.forEach(function(study) {
            var studyRow = '<tr><td>' +
                    study.patientName + '</td><td>' +
                    study.patientId + '</td><td>' +
                    study.studyDate + '</td><td>' +
                    study.modality + '</td><td>' +
                    study.studyDescription + '</td><td>' +
                    study.numImages + '</td><td>' +
                    '</tr>';
             var studyRowElement = $('#studyListData').append(studyRow);
            $(studyRowElement).click(function() {
                // Add new tab for this study and switch to it
                var studyTab = '<li><a href="#x' + study.patientId + '" data-toggle="tab">' + study.patientName + '</a></li>';
                $('#tabs').append(studyTab);

                // add tab content by making a copy of the studyViewerTemplate element
                var studyViewerCopy = $('#studyViewerTemplate').clone();
                studyViewerCopy.attr("id", 'x' + study.patientId);
                studyViewerCopy.removeClass('hidden');
                studyViewerCopy.appendTo('#tabContent');

                // show the new tab (which will be the last one since it was just added
                $('#tabs a:last').tab('show');

                // Now load the study.json
                loadStudyJson(study.studyId + ".json");
            });
        });
    });

</script>

</body>
</html>
