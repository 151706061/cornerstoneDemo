/*! cornerstoneTools - v0.0.1 - 2014-04-08 | (c) 2014 Chris Hafey | https://github.com/chafey/cornerstoneTools */
var cornerstoneTools=function(a,b,c){"use strict";function d(a){if(!("mousewheel"===a.originalEvent.type&&0===a.originalEvent.wheelDeltaY||"DOMMouseScroll"===a.originalEvent.type&&1===a.originalEvent.axis)){var c=a.currentTarget,d=b.pageToImage(c,a.pageX,a.pageY);a=window.event||a;var e=a.wheelDelta||-a.detail||-a.originalEvent.detail,f=Math.max(-1,Math.min(1,e)),g=({element:c,viewport:b.getViewport(c),image:b.getEnabledElement(c).image,direction:f,pageX:a.pageX,pageY:a.pageY,imageX:d.x,imageY:d.y},new CustomEvent("CornerstoneToolsMouseWheel",{detail:{event:a,direction:f,viewport:b.getViewport(c),image:b.getEnabledElement(c).image,element:c},bubbles:!1,cancelable:!1}));c.dispatchEvent(g)}}function e(b){a(b).on(g,d)}function f(b){a(b).unbind(g,d)}void 0===c&&(c={});var g="mousewheel DOMMouseScroll";return c.mouseWheelInput={enable:e,disable:f},c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c){"use strict";function d(a){var b=new CustomEvent("CornerstoneToolsMouseDownActivate",{detail:a,bubbles:!1,cancelable:!0});a.element.dispatchEvent(b)}function e(e){function f(a){var d={page:c.point.pageToPoint(a),image:b.pageToImage(h,a.pageX,a.pageY)},e={page:c.point.subtract(d.page,j.page),image:c.point.subtract(d.image,j.image)},f=new CustomEvent("CornerstoneToolsMouseDrag",{detail:{event:a,which:m,viewport:b.getViewport(h),image:b.getEnabledElement(h).image,element:h,startPoints:i,lastPoints:j,currentPoints:d,deltaPoints:e},bubbles:!1,cancelable:!0});return h.dispatchEvent(f),j=c.copyPoints(d),c.pauseEvent(a)}function g(d){var e={page:c.point.pageToPoint(d),image:b.pageToImage(h,d.pageX,d.pageY)},k={page:c.point.subtract(e.page,j.page),image:c.point.subtract(e.image,j.image)},l=new CustomEvent("CornerstoneToolsMouseUp",{detail:{event:d,which:m,viewport:b.getViewport(h),image:b.getEnabledElement(h).image,element:h,startPoints:i,lastPoints:j,currentPoints:e,deltaPoints:k},bubbles:!1,cancelable:!1});h.dispatchEvent(l),a(document).off("mousemove",f),a(document).off("mouseup",g)}var h=(e.data,e.currentTarget),i={page:c.point.pageToPoint(e),image:b.pageToImage(h,e.pageX,e.pageY)},j=c.copyPoints(i),k={event:e,which:e.which,viewport:b.getViewport(h),image:b.getEnabledElement(h).image,element:h,startPoints:i,lastPoints:j,currentPoints:i,deltaPoints:{x:0,y:0}},l=new CustomEvent("CornerstoneToolsMouseDown",{detail:k,bubbles:!1,cancelable:!0});if(h.dispatchEvent(l)===!0&&d(k)===!0)return c.pauseEvent(e);var m=e.which;return a(document).on("mousemove",f),a(document).on("mouseup",g),c.pauseEvent(e)}function f(a){var d=(a.data,a.currentTarget),e={page:c.point.pageToPoint(a),image:b.pageToImage(d,a.pageX,a.pageY)},f=c.copyPoints(e),g=a.which,h={page:c.point.pageToPoint(a),image:b.pageToImage(d,a.pageX,a.pageY)},i={page:c.point.subtract(h.page,f.page),image:c.point.subtract(h.image,f.image)},j=new CustomEvent("CornerstoneToolsMouseMove",{detail:{event:a,which:g,viewport:b.getViewport(d),image:b.getEnabledElement(d).image,element:d,startPoints:e,lastPoints:f,currentPoints:h,deltaPoints:i},bubbles:!1,cancelable:!1});d.dispatchEvent(j),f=c.copyPoints(h)}function g(b){a(b).on("mousedown",e),a(b).on("mousemove",f)}function h(b){a(b).off("mousedown",e),a(b).off("mousemove",f)}return void 0===c&&(c={}),c.mouseInput={enable:g,disable:h},c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c){"use strict";function d(b){var c={activate:function(c,d){a(c).off("CornerstoneToolsMouseDownActivate",b);var e={mouseButtonMask:d};a(c).on("CornerstoneToolsMouseDownActivate",e,b)},disable:function(c){a(c).off("CornerstoneToolsMouseDownActivate",b)},enable:function(c){a(c).off("CornerstoneToolsMouseDownActivate",b)},deactivate:function(c){a(c).off("CornerstoneToolsMouseDownActivate",b)}};return c}return void 0===c&&(c={}),c.simpleMouseButtonTool=d,c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c){"use strict";function d(d){function e(b){var e=d.createNewMeasurement(b);c.addToolState(b.element,d.toolType,e),a(b.element).off("CornerstoneToolsMouseMove",g),c.moveHandle(b,e.handles.end,function(){c.anyHandlesOutsideImage(b,e.handles)&&c.removeToolState(b.element,d.toolType,e),a(b.element).on("CornerstoneToolsMouseMove",g)})}function f(a){var b=a.originalEvent.detail,d=a.data;return c.isMouseButtonEnabled(b.which,d.mouseButtonMask)?(e(b),!1):void 0}function g(a){var e=a.originalEvent.detail;if(0===e.which){var f=c.getToolState(e.element,d.toolType);if(void 0!==f){for(var g=!1,h=0;h<f.data.length;h++){var i=f.data[h];c.handleActivator(i.handles,e.currentPoints.image,e.viewport.scale)===!0&&(g=!0)}g===!0&&b.updateImage(e.element)}}}function h(a,b){for(var d in a.handles){var e=c.point.distanceSquared(a.handles[d],b);if(25>e)return a.handles[d]}}function i(b){function e(){c.anyHandlesOutsideImage(j,f.handles)&&c.removeToolState(j.element,d.toolType,f),a(j.element).on("CornerstoneToolsMouseMove",g)}var f,i=b.data,j=b.originalEvent.detail;if(c.isMouseButtonEnabled(j.which,i.mouseButtonMask)){var k,l=j.startPoints.image,m=c.getToolState(b.currentTarget,d.toolType);if(void 0!==m)for(k=0;k<m.data.length;k++){f=m.data[k];var n=h(f,l);if(void 0!==n)return a(j.element).off("CornerstoneToolsMouseMove",g),c.moveHandle(j,n,e),!1}if(void 0!==m&&void 0!==d.pointNearTool)for(k=0;k<m.data.length;k++)if(f=m.data[k],d.pointNearTool(f,l))return a(j.element).off("CornerstoneToolsMouseMove",g),c.moveAllHandles(b,f,m,!0),!1}}function j(c){a(c).off("CornerstoneImageRendered",d.onImageRendered),a(c).off("CornerstoneToolsMouseMove",g),a(c).off("CornerstoneToolsMouseDown",i),a(c).off("CornerstoneToolsMouseDownActivate",f),b.updateImage(c)}function k(c){a(c).off("CornerstoneImageRendered",d.onImageRendered),a(c).off("CornerstoneToolsMouseMove",g),a(c).off("CornerstoneToolsMouseDown",i),a(c).off("CornerstoneToolsMouseDownActivate",f),a(c).on("CornerstoneImageRendered",d.onImageRendered),b.updateImage(c)}function l(c,e){var h={mouseButtonMask:e};a(c).off("CornerstoneImageRendered",d.onImageRendered),a(c).off("CornerstoneToolsMouseMove",g),a(c).off("CornerstoneToolsMouseDown",i),a(c).off("CornerstoneToolsMouseDownActivate",f),a(c).on("CornerstoneImageRendered",d.onImageRendered),a(c).on("CornerstoneToolsMouseMove",h,g),a(c).on("CornerstoneToolsMouseDown",h,i),a(c).on("CornerstoneToolsMouseDownActivate",h,f),b.updateImage(c)}function m(c,e){var h={mouseButtonMask:e};a(c).off("CornerstoneImageRendered",d.onImageRendered),a(c).off("CornerstoneToolsMouseMove",g),a(c).off("CornerstoneToolsMouseDown",i),a(c).off("CornerstoneToolsMouseDownActivate",f),a(c).on("CornerstoneImageRendered",d.onImageRendered),a(c).on("CornerstoneToolsMouseMove",h,g),a(c).on("CornerstoneToolsMouseDown",h,i),b.updateImage(c)}var n={enable:k,disable:j,activate:l,deactivate:m};return n}return void 0===c&&(c={}),c.mouseButtonTool=d,c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c){"use strict";function d(b){var c={activate:function(c){a(c).off("CornerstoneToolsMouseWheel",b);var d={};a(c).on("CornerstoneToolsMouseWheel",d,b)},disable:function(c){a(c).off("CornerstoneToolsMouseWheel",b)},enable:function(c){a(c).off("CornerstoneToolsMouseWheel",b)},deactivate:function(c){a(c).off("CornerstoneToolsMouseWheel",b)}};return c}return void 0===c&&(c={}),c.mouseWheelTool=d,c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c){"use strict";function d(b){var c={activate:function(c){a(c).off("CornerstoneToolsTouchDrag",b);var d={};a(c).on("CornerstoneToolsTouchDrag",d,b)},disable:function(c){a(c).off("CornerstoneToolsTouchDrag",b)},enable:function(c){a(c).off("CornerstoneToolsTouchDrag",b)},deactivate:function(c){a(c).off("CornerstoneToolsTouchDrag",b)}};return c}return void 0===c&&(c={}),c.touchDragTool=d,c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c){"use strict";function d(b){var c={activate:function(c){a(c).off("CornerstoneToolsTouchPinch",b);var d={};a(c).on("CornerstoneToolsTouchPinch",d,b)},disable:function(c){a(c).off("CornerstoneToolsTouchPinch",b)},enable:function(c){a(c).off("CornerstoneToolsTouchPinch",b)},deactivate:function(c){a(c).off("CornerstoneToolsTouchPinch",b)}};return c}return void 0===c&&(c={}),c.touchPinchTool=d,c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c,d){"use strict";function e(a){var b={visible:!0,handles:{start:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!1},end:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!0}}};return b}function f(a,b){var c={left:Math.min(a.handles.start.x,a.handles.end.x),top:Math.min(a.handles.start.y,a.handles.end.y),width:Math.abs(a.handles.start.x-a.handles.end.x),height:Math.abs(a.handles.start.y-a.handles.end.y)},e=d.rect.distanceToPoint(c,b);return 5>e}function g(a,b){var c=a.width/2,d=a.height/2;if(0>=c||0>=d)return!1;var e={x:a.left+c,y:a.top+d},f={x:b.x-e.x,y:b.y-e.y},g=f.x*f.y/(c*c)+f.y*f.y/(d*d)<=1;return g}function h(a,b){for(var c=0,d=0,e=0,f=0,h=b.top;h<b.top+b.height;h++)for(var i=b.left;i<b.left+b.width;i++)g(b,{x:i,y:h})===!0&&(c+=a[f],d+=a[f]*a[f],e++),f++;if(0===e)return{count:e,mean:0,variance:0,stdDev:0};var j=c/e,k=d/e-j*j;return{count:e,mean:j,variance:k,stdDev:Math.sqrt(k)}}function i(a){var e=d.getToolState(a.currentTarget,j);if(void 0!==e){var f=a.originalEvent.detail,g=f.canvasContext.canvas.getContext("2d");c.setToPixelCoordinateSystem(f.enabledElement,g);for(var i=0;i<e.data.length;i++){g.save();var k=e.data[i],l=Math.abs(k.handles.start.x-k.handles.end.x),m=Math.abs(k.handles.start.y-k.handles.end.y),n=Math.min(k.handles.start.x,k.handles.end.x),o=Math.min(k.handles.start.y,k.handles.end.y),p=(k.handles.start.x+k.handles.end.x)/2,q=(k.handles.start.y+k.handles.end.y)/2;g.beginPath(),g.strokeStyle="white",g.lineWidth=1/f.viewport.scale,c.drawEllipse(g,n,o,l,m),g.closePath(),g.beginPath(),d.drawHandles(g,f,k.handles),g.stroke();var r=b.getStoredPixels(f.element,n,o,l,m),s={left:n,top:o,width:l,height:m},t=h(r,s),u=Math.PI*(l*f.image.columnPixelSpacing/2)*(m*f.image.rowPixelSpacing/2),v="Area: "+u.toFixed(2)+" mm^2",w=c.setToFontCoordinateSystem(f.enabledElement,f.canvasContext,15);g.font=""+w.fontSize+"px Arial";var x=g.measureText(u),y=w.lineHeight,z=p<f.image.columns/2?p+l/2:p-l/2-x.width*w.fontScale,A=q<f.image.rows/2?q+m/2:q-m/2;z/=w.fontScale,A/=w.fontScale,g.fillStyle="white",g.fillText("Mean: "+t.mean.toFixed(2),z,A-y),g.fillText("StdDev: "+t.stdDev.toFixed(2),z,A),g.fillText(v,z,A+y),g.restore()}}}void 0===d&&(d={});var j="ellipticalRoi";return d.ellipticalRoi=d.mouseButtonTool({createNewMeasurement:e,onImageRendered:i,pointNearTool:f,toolType:j}),d}($,cornerstone,cornerstoneCore,cornerstoneTools),cornerstoneTools=function(a,b,c,d){"use strict";function e(a){var b={visible:!0,handles:{start:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!1},end:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!0}}};return b}function f(a,b){var c={start:a.handles.start,end:a.handles.end},e=d.lineSegment.distanceToPoint(c,b);return 5>e}function g(a){var b=d.getToolState(a.currentTarget,h);if(void 0!==b){var e=a.originalEvent.detail,f=e.canvasContext.canvas.getContext("2d");c.setToPixelCoordinateSystem(e.enabledElement,f);for(var g=0;g<b.data.length;g++){f.save();var i=b.data[g];f.beginPath(),f.strokeStyle="white",f.lineWidth=1/e.viewport.scale,f.moveTo(i.handles.start.x,i.handles.start.y),f.lineTo(i.handles.end.x,i.handles.end.y),f.stroke(),f.beginPath(),d.drawHandles(f,e,i.handles),f.stroke(),f.fillStyle="white";var j=i.handles.start.x-i.handles.end.x*e.image.columnPixelSpacing,k=i.handles.start.y-i.handles.end.y*e.image.rowPixelSpacing,l=Math.sqrt(j*j+k*k),m=""+l.toFixed(2)+" mm",n=c.setToFontCoordinateSystem(e.enabledElement,e.canvasContext,15);f.font=""+n.fontSize+"px Arial";var o=(i.handles.start.x+i.handles.end.x)/2/n.fontScale,p=(i.handles.start.y+i.handles.end.y)/2/n.fontScale;f.fillText(m,o,p),f.restore()}}}void 0===d&&(d={});var h="length";return d.length=d.mouseButtonTool({createNewMeasurement:e,onImageRendered:g,pointNearTool:f,toolType:h}),d}($,cornerstone,cornerstoneCore,cornerstoneTools),cornerstoneTools=function(a,b,c){"use strict";function d(b){var c=b.originalEvent.detail;a(c.element).off("CornerstoneToolsMouseDrag",f),a(c.element).off("CornerstoneToolsMouseUp",d)}function e(b){var e=b.originalEvent.detail;return c.isMouseButtonEnabled(e.which,b.data.mouseButtonMask)?(a(e.element).on("CornerstoneToolsMouseDrag",f),a(e.element).on("CornerstoneToolsMouseUp",d),!1):void 0}function f(a){var c=a.originalEvent.detail;return c.viewport.centerX+=c.deltaPoints.page.x/c.viewport.scale,c.viewport.centerY+=c.deltaPoints.page.y/c.viewport.scale,b.setViewport(c.element,c.viewport),!1}function g(a,c){c.viewport.centerX+=c.deltaPageX/c.viewport.scale,c.viewport.centerY+=c.deltaPageY/c.viewport.scale,b.setViewport(a,c.viewport)}function h(a){c.onDrag(a,g)}return void 0===c&&(c={}),c.pan=c.simpleMouseButtonTool(e),c.panTouchDrag=c.touchDragTool(h),c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c,d){"use strict";function e(a){var b={visible:!0,handles:{end:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!0}}};return b}function f(a){var e=d.getToolState(a.currentTarget,g);if(void 0!==e){var f=a.originalEvent.detail,h=f.canvasContext.canvas.getContext("2d");c.setToPixelCoordinateSystem(f.enabledElement,h);for(var i=0;i<e.data.length;i++){h.save();var j=e.data[i];h.beginPath(),d.drawHandles(h,f,j.handles),h.stroke();var k=c.setToFontCoordinateSystem(f.enabledElement,f.canvasContext,15);h.font=""+k.fontSize+"px Arial";var l=Math.round(j.handles.end.x),m=Math.round(j.handles.end.y);n=j.handles.end.x+3,o=j.handles.end.y-3;var n=n/k.fontScale,o=o/k.fontScale;h.fillStyle="white";var p=b.getStoredPixels(f.element,l,m,1,1),q=p[0],r=q*f.image.slope+f.image.intercept;h.fillText(""+l+","+m,n,o),h.fillText("SP: "+q+" MO: "+r,n,o+k.lineHeight),h.restore()}}}void 0===d&&(d={});var g="probe";return d.probe=d.mouseButtonTool({createNewMeasurement:e,onImageRendered:f,toolType:g}),d}($,cornerstone,cornerstoneCore,cornerstoneTools),cornerstoneTools=function(a,b,c,d){"use strict";function e(a){var b={visible:!0,handles:{start:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!1},end:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!0}}};return b}function f(a,b){var c={left:Math.min(a.handles.start.x,a.handles.end.x),top:Math.min(a.handles.start.y,a.handles.end.y),width:Math.abs(a.handles.start.x-a.handles.end.x),height:Math.abs(a.handles.start.y-a.handles.end.y)},e=d.rect.distanceToPoint(c,b);return 5>e}function g(a,b){for(var c=0,d=0,e=0,f=0,g=b.top;g<b.top+b.height;g++)for(var h=b.left;h<b.left+b.width;h++)c+=a[f],d+=a[f]*a[f],e++,f++;if(0===e)return{count:e,mean:0,variance:0,stdDev:0};var i=c/e,j=d/e-i*i;return{count:e,mean:i,variance:j,stdDev:Math.sqrt(j)}}function h(a){var e=d.getToolState(a.currentTarget,i);if(void 0!==e){var f=a.originalEvent.detail,h=f.canvasContext.canvas.getContext("2d");c.setToPixelCoordinateSystem(f.enabledElement,h);for(var j=0;j<e.data.length;j++){h.save();var k=e.data[j],l=Math.abs(k.handles.start.x-k.handles.end.x),m=Math.abs(k.handles.start.y-k.handles.end.y),n=Math.min(k.handles.start.x,k.handles.end.x),o=Math.min(k.handles.start.y,k.handles.end.y),p=(k.handles.start.x+k.handles.end.x)/2,q=(k.handles.start.y+k.handles.end.y)/2;h.beginPath(),h.strokeStyle="white",h.lineWidth=1/f.viewport.scale,h.rect(n,o,l,m),h.stroke(),h.beginPath(),d.drawHandles(h,f,k.handles),h.stroke();var r=b.getStoredPixels(f.element,n,o,l,m),s={left:n,top:o,width:l,height:m},t=g(r,s),u=l*f.image.columnPixelSpacing*m*f.image.rowPixelSpacing,v="Area: "+u.toFixed(2)+" mm^2",w=c.setToFontCoordinateSystem(f.enabledElement,f.canvasContext,15);h.font=""+w.fontSize+"px Arial";var x=h.measureText(u),y=w.lineHeight,z=p<f.image.columns/2?p+l/2:p-l/2-x.width*w.fontScale,A=q<f.image.rows/2?q+m/2:q-m/2;z/=w.fontScale,A/=w.fontScale,h.fillStyle="white",h.fillText("Mean: "+t.mean.toFixed(2),z,A-y),h.fillText("StdDev: "+t.stdDev.toFixed(2),z,A),h.fillText(v,z,A+y),h.restore()}}}void 0===d&&(d={});var i="rectangleRoi";return d.rectangleRoi=d.mouseButtonTool({createNewMeasurement:e,onImageRendered:h,pointNearTool:f,toolType:i}),d}($,cornerstone,cornerstoneCore,cornerstoneTools),cornerstoneTools=function(a,b,c){"use strict";function d(b){var c=b.originalEvent.detail;a(c.element).off("CornerstoneToolsMouseDrag",f),a(c.element).off("CornerstoneToolsMouseUp",d)}function e(b){var e=b.originalEvent.detail;return c.isMouseButtonEnabled(e.which,b.data.mouseButtonMask)?(a(e.element).on("CornerstoneToolsMouseDrag",f),a(e.element).on("CornerstoneToolsMouseUp",d),!1):void 0}function f(a){var c=a.originalEvent.detail,d=c.image.maxPixelValue-c.image.minPixelValue,e=d/1024;return c.viewport.windowWidth+=c.deltaPoints.page.x*e,c.viewport.windowCenter+=c.deltaPoints.page.y*e,b.setViewport(c.element,c.viewport),!1}function g(a){var c=a.originalEvent.detail,d=c.image.maxPixelValue-c.image.minPixelValue,e=d/1024;c.viewport.windowWidth+=c.deltaPoints.page.x*e,c.viewport.windowCenter+=c.deltaPoints.page.y*e,b.setViewport(c.element,c.viewport)}return void 0===c&&(c={}),c.wwwc=c.simpleMouseButtonTool(e),c.wwwcTouchDrag=c.touchDragTool(g),c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c){"use strict";function d(a,c,d){var e=1.7,f=Math.log(c.scale)/Math.log(e),g=f+d,h=Math.pow(e,g);c.scale=h,b.setViewport(a,c)}function e(b){var c=b.originalEvent.detail;a(c.element).off("CornerstoneToolsMouseDrag",g),a(c.element).off("CornerstoneToolsMouseUp",e)}function f(b){var d=b.originalEvent.detail;return c.isMouseButtonEnabled(d.which,b.data.mouseButtonMask)?(a(d.element).on("CornerstoneToolsMouseDrag",g),a(d.element).on("CornerstoneToolsMouseUp",e),!1):void 0}function g(a){var c=a.originalEvent.detail,e=c.deltaPoints.page.y/100;d(c.element,c.viewport,e);var f=b.pageToImage(c.element,c.startPoints.page.x,c.startPoints.page.y);return c.viewport.centerX-=c.startPoints.image.x-f.x,c.viewport.centerY-=c.startPoints.image.y-f.y,b.setViewport(c.element,c.viewport),!1}function h(a){var b=a.originalEvent.detail,c=-b.direction/4;d(b.element,b.viewport,c)}function i(a){var b=a.originalEvent.detail;d(b.element,b.viewport,b.direction/4)}return void 0===c&&(c={}),c.zoom=c.simpleMouseButtonTool(f),c.zoomWheel=c.mouseWheelTool(h),c.zoomTouchPinch=c.touchPinchTool(i),c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c){"use strict";function d(d){if(d.gesture.preventDefault(),d.gesture.stopPropagation(),j!==!0){var e,f=d.currentTarget;if("transform"===d.type){var k=i-d.gesture.scale;i=d.gesture.scale,e=new CustomEvent("CornerstoneToolsTouchPinch",{detail:{event:d,viewport:b.getViewport(f),image:b.getEnabledElement(f).image,element:f,direction:0>k?1:-1},bubbles:!1,cancelable:!1})}else{if("dragstart"===d.type)return g={page:c.point.pageToPoint(d.gesture.touches[0]),image:b.pageToImage(f,d.gesture.touches[0].pageX,d.gesture.touches[0].pageY)},void(h=c.copyPoints(g));if("drag"!==d.type)return;var l={page:c.point.pageToPoint(d.gesture.touches[0]),image:b.pageToImage(f,d.gesture.touches[0].pageX,d.gesture.touches[0].pageY)},m={page:c.point.subtract(l.page,h.page),image:c.point.subtract(l.image,h.image)};e=new CustomEvent("CornerstoneToolsTouchDrag",{detail:{event:d,viewport:b.getViewport(f),image:b.getEnabledElement(f).image,element:f,startPoints:g,lastPoints:h,currentPoints:l,deltaPoints:m},bubbles:!1,cancelable:!1}),h=a.extend({},l)}j=!0,setTimeout(function(){f.dispatchEvent(e),j=!1},1)}}function e(b){var c={transform_always_block:!0,transform_min_scale:.01,drag_block_horizontal:!0,drag_block_vertical:!0,drag_min_distance:0};a(b).hammer(c).on("touch drag transform dragstart",d)}function f(b){a(b).hammer().off("touch drag transform dragstart",d)}void 0===c&&(c={});var g,h,i=1,j=!1;return c.touchInput={enable:e,disable:f},c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c,d){"use strict";function e(a,b){var c=a.image,e={left:0,top:0,width:c.width,height:c.height},f=!1;for(var g in b){var h=b[g];d.point.insideRect(h,e)===!1&&(f=!0)}return f}return void 0===d&&(d={}),d.anyHandlesOutsideImage=e,d}($,cornerstone,cornerstoneCore,cornerstoneTools),cornerstoneTools=function(a,b,c,d){"use strict";function e(a,b,c){a.strokeStyle="white";var d=f/b.viewport.scale;for(var e in c){var g=c[e];(g.active||g.highlight)&&(a.beginPath(),a.lineWidth=g.active?2/b.viewport.scale:.5/b.viewport.scale,a.arc(g.x,g.y,d,0,2*Math.PI),a.stroke())}}void 0===d&&(d={});var f=6;return d.drawHandles=e,d}($,cornerstone,cornerstoneCore,cornerstoneTools),cornerstoneTools=function(a,b,c,d){"use strict";function e(a,b,d){var e=h/d;for(var f in a){var g=a[f],i=c.distance(b,g);if(e>=i)return g}return void 0}function f(a){for(var b in a){var c=a[b];if(c.active===!0)return c}return void 0}function g(a,b,c){var d=f(a),g=e(a,b,c);return d!==g?(void 0!==g&&(g.active=!0),void 0!==d&&(d.active=!1),!0):!1}void 0===d&&(d={});var h=6;return d.handleActivator=g,d}($,cornerstone,cornerstoneCore,cornerstoneTools),cornerstoneTools=function(a,b,c,d){"use strict";function e(c,d,e){function f(a){var c=a.originalEvent.detail;d.x=c.currentPoints.image.x,d.y=c.currentPoints.image.y,b.updateImage(h)}function g(){d.eactive=!1,a(h).off("CornerstoneToolsMouseDrag",f),a(h).off("CornerstoneToolsMouseUp",g),b.updateImage(h),e()}var h=c.element;a(h).on("CornerstoneToolsMouseDrag",f),a(h).on("CornerstoneToolsMouseUp",g)}return void 0===d&&(d={}),d.moveHandle=e,d}($,cornerstone,cornerstoneCore,cornerstoneTools),cornerstoneTools=function(a,b,c,d){"use strict";function e(c,e,f,g){function h(a){var c=a.originalEvent.detail;for(var d in e.handles){var f=e.handles[d];f.x+=c.deltaPoints.image.x,f.y+=c.deltaPoints.image.y}return b.updateImage(k),!1}function i(c){e.moving=!1;var j=c.originalEvent.detail;if(a(k).off("CornerstoneToolsMouseDrag",h),a(k).off("CornerstoneToolsMouseUp",i),g===!0){var l=j.image,m=!1,n={top:0,left:0,width:l.width,height:l.height};for(var o in e.handles){var p=e.handles[o];d.point.insideRect(p,n)===!1&&(m=!0)}if(m){for(var q=-1,r=0;r<f.data.length;r++)f.data[r]===e&&(q=r);-1!==q&&f.data.splice(q,1)}}b.updateImage(k)}var j=c.originalEvent.detail,k=j.element;return a(k).on("CornerstoneToolsMouseDrag",h),a(k).on("CornerstoneToolsMouseUp",i),!0}return void 0===d&&(d={}),d.moveAllHandles=e,d}($,cornerstone,cornerstoneCore,cornerstoneTools),cornerstoneTools=function(a,b,c){"use strict";function d(a){return a*a}function e(a,b){return d(a.x-b.x)+d(a.y-b.y)}function f(a,b){var c=e(a.start,a.end);if(0===c)return e(b,a.start);var d=((b.x-a.start.x)*(a.end.x-a.start.x)+(b.y-a.start.y)*(a.end.y-a.start.y))/c;if(0>d)return e(b,a.start);if(d>1)return e(b,a.end);var f={x:a.start.x+d*(a.end.x-a.start.x),y:a.start.y+d*(a.end.y-a.start.y)};return e(b,f)}function g(a,b){return Math.sqrt(f(a,b))}return void 0===c&&(c={}),c.lineSegment={distanceToPoint:g},c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c){"use strict";function d(a){return{x:a.pageX,y:a.pageY}}function e(a,b){return{x:a.x-b.x,y:a.y-b.y}}function f(a){return{x:a.x,y:a.y}}function g(a,b){return Math.sqrt(h(a,b))}function h(a,b){var c=e(a,b);return c.x*c.x+c.y*c.y}function i(a,b){return a.x<b.left||a.x>b.left+b.width||a.y<b.top||a.y>b.top+b.height?!1:!0}return void 0===c&&(c={}),c.point={subtract:e,copy:f,pageToPoint:d,distance:g,distanceSquared:h,insideRect:i},c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c){"use strict";function d(a){var b={start:{x:a.left,y:a.top},end:{x:a.left+a.width,y:a.top}},c={start:{x:a.left+a.width,y:a.top},end:{x:a.left+a.width,y:a.top+a.height}},d={start:{x:a.left+a.width,y:a.top+a.height},end:{x:a.left,y:a.top+a.height}},e={start:{x:a.left,y:a.top+a.height},end:{x:a.left,y:a.top}},f=[b,c,d,e];return f}function e(a,b){var e=655535,f=d(a);return f.forEach(function(a){var d=c.lineSegment.distanceToPoint(a,b);e>d&&(e=d)}),e}return void 0===c&&(c={}),c.rect={distanceToPoint:e},c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c){"use strict";function d(a){var e=c.getToolState(a,"stack");if(void 0!==e&&void 0!==e.data&&0!==e.data.length){var f=c.getToolState(a,g);if(void 0!==f){var h=f.data[0],i=e.data[0],j=h.prefetchImageIdIndex+1;if(j=Math.min(i.imageIds.length-1,j),j=Math.max(0,j),j===h.prefetchImageIdIndex)return void(h.enabled=!1);h.prefetchImageIdIndex=j;var k=i.imageIds[j],l=b.loadImage(k);l.done(function(){setTimeout(function(){d(a)},1)})}}}function e(a){var b=c.getToolState(a,g);void 0===b&&(b={prefetchImageIdIndex:0,enabled:!0},c.addToolState(a,g,b)),d(a)}function f(a){var b=c.getToolState(a,g);void 0===b?(b={prefetchImageIdIndex:0,enabled:!1},c.addToolState(a,g,b)):b.enabled=!1}void 0===c&&(c={});var g="stackPrefetch";return c.stackPrefetch={enable:e,disable:f},c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c){"use strict";function d(a,d){var e=c.getToolState(a,"stack");if(void 0!==e&&void 0!==e.data&&0!==e.data.length){var f=e.data[0],g=f.currentImageIdIndex+d;g=Math.min(f.imageIds.length-1,g),g=Math.max(0,g),g!==f.currentImageIdIndex&&(f.currentImageIdIndex=g,b.newStackImage(a,f.imageIds[g]))}}function e(b){var c=b.originalEvent.detail;a(c.element).off("CornerstoneToolsMouseDrag",g),a(c.element).off("CornerstoneToolsMouseUp",e)}function f(b){var d=b.originalEvent.detail;return c.isMouseButtonEnabled(d.which,b.data.mouseButtonMask)?(a(d.element).on("CornerstoneToolsMouseDrag",g),a(d.element).on("CornerstoneToolsMouseUp",e),!1):void 0}function g(a){var b=a.originalEvent.detail,c=b.deltaPoints.page.y;return d(b.element,c),!1}function h(a){var b=a.originalEvent.detail,c=-b.direction;d(b.element,c)}void 0===c&&(c={});return c.stackScroll=c.simpleMouseButtonTool(f),c.stackScrollWheel=c.mouseWheelTool(h),c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c,d){"use strict";function e(){function a(a,c,e){var f=b.getEnabledElement(a);d.hasOwnProperty(f.ids.imageId)===!1&&(d[f.ids.imageId]={});var g=d[f.ids.imageId];g.hasOwnProperty(c)===!1&&(g[c]={data:[]});var h=g[c];h.data.push(e)}function c(a,c){var e=b.getEnabledElement(a);if(d.hasOwnProperty(e.ids.imageId)===!1)return void 0;var f=d[e.ids.imageId];if(f.hasOwnProperty(c)===!1)return void 0;var g=f[c];return g}var d={},e={get:c,add:a};return e}void 0===d&&(d={});var f=e();return d.newImageIdSpecificToolStateManager=e,d.globalImageIdSpecificToolStateManager=f,d}($,cornerstone,cornerstoneCore,cornerstoneTools),cornerstoneTools=function(a,b,c,d){"use strict";function e(a,c){function d(d,e,g){if(!(a.indexOf(e)>=0))return c.add(d,e,g);b.getEnabledElement(d);f.hasOwnProperty(e)===!1&&(f[e]={data:[]});var h=f[e];h.data.push(g)}function e(b,d){if(a.indexOf(d)>=0){f.hasOwnProperty(d)===!1&&(f[d]={data:[]});var e=f[d];return e}return c.get(b,d)}var f={},g={get:e,add:d};return g}function f(a){var b=d.getElementToolStateManager(a);void 0===b&&(b=d.globalImageIdSpecificToolStateManager);var c=["stack","stackScroll"],e=d.newStackSpecificToolStateManager(c,b);g.push(e),d.setElementToolStateManager(a,e)}void 0===d&&(d={});var g=[];return d.newStackSpecificToolStateManager=e,d.addStackStateManager=f,d}($,cornerstone,cornerstoneCore,cornerstoneTools),cornerstoneTools=function(a,b,c,d){"use strict";function e(a){var c=b.getEnabledElement(a);return void 0===c.toolStateManager&&(c.toolStateManager=d.globalImageIdSpecificToolStateManager),c.toolStateManager}function f(a,b,c){var d=e(a);d.add(a,b,c)}function g(a,b){var c=e(a);return c.get(a,b)}function h(a,b,c){for(var d=e(a),f=d.get(a,b),g=-1,h=0;h<f.data.length;h++)f.data[h]===c&&(g=h);-1!==g&&f.data.splice(g,1)}function i(a,c){var d=b.getEnabledElement(a);d.toolStateManager=c}return void 0===d&&(d={}),d.addToolState=f,d.getToolState=g,d.removeToolState=h,d.setElementToolStateManager=i,d.getElementToolStateManager=e,d}($,cornerstone,cornerstoneCore,cornerstoneTools),cornerstoneTools=function(a,b,c){"use strict";function d(a){var b=c.point.copy(a.page),d=c.point.copy(a.image);return{page:b,image:d}}return void 0===c&&(c={}),c.copyPoints=d,c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c){"use strict";function d(a,b){var c=1<<a-1;return 0!==(b&c)}return void 0===c&&(c={}),c.isMouseButtonEnabled=d,c}($,cornerstone,cornerstoneTools),cornerstoneTools=function(a,b,c){"use strict";function d(a){return a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault(),a.cancelBubble=!0,a.returnValue=!1,!1}return void 0===c&&(c={}),c.pauseEvent=d,c}($,cornerstone,cornerstoneTools);